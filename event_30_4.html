<!DOCTYPE html>
<html lang="vi">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Event 30/4 & 1/5 TieuLinh Hota</title>
    <link rel="icon" href="http://tieulinhhota.com/assets/images/favicon.jpg" type="image/x-icon">
    <style>
        #passwordInput {
        width: 350px;
        padding: 10px;
        margin-bottom: 12px;
        border: 2px solid #ff4c4c; /* ƒê∆∞·ªùng vi·ªÅn ƒë·ªè */
        border-radius: 8px;
        background-color: #222; /* N·ªÅn ƒëen */
        color: white;
        font-size: 18px;
        font-family: 'Arial', sans-serif;
        outline: none;
        transition: all 0.3s ease;
        }

        #passwordInput::placeholder {
        color: #bbb; /* M√†u placeholder x√°m */
        }

        #passwordInput:focus {
        border-color: #f72b2b; /* ƒê·ªïi m√†u vi·ªÅn khi focus */
        background-color: #333; /* ƒê·ªïi n·ªÅn khi focus */
        }

        #checkPasswordBtn {
        padding: 12px 24px;
        font-size: 16px;
        font-weight: bold;
        color: white;
        background-color: #ff4c4c;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 10px;
        }

        #checkPasswordBtn:hover {
        background-color: #f72b2b; /* ƒê·ªïi m√†u n·ªÅn khi hover */
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(255, 76, 76, 0.6);
        }

        #checkPasswordBtn:active {
        transform: scale(0.98);
        }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #222, #444);
            color: #f5f5f5;
            padding: 20px;
        }
        h1 {
            color: #ff4c4c;
            text-align: center;
            font-size: 36px;
            text-transform: uppercase;
            margin-bottom: 30px;
            letter-spacing: 2px;
            text-shadow: 2px 2px 10px rgba(255, 0, 0, 0.5);
        }
        .flag-container {
            position: relative;
            width: 400px;
            height: 266px;
            margin: 0 auto 30px;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/2/21/Flag_of_Vietnam.svg');
            background-size: cover;
            border: 3px solid #ff4c4c;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.8);
            transition: transform 0.5s ease;
        }
        .flag-container:hover {
            transform: rotate(0deg);
        }
        .overlay-piece {
            position: absolute;
            width: 5%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.7);
            transition: opacity 0.4s ease, transform 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        .overlay-piece:hover {
            transform: scale(1.1);
            background-color: rgba(255, 0, 0, 0.8);
        }
        .hidden {
            opacity: 0;
        }
        table {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            border-collapse: collapse;
            background: #333;
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 12px;
            border-bottom: 1px solid #444;
            text-align: left;
        }
        th {
            background-color: #222;
            color: #ff4c4c;
            font-size: 18px;
            letter-spacing: 1px;
        }
        td {
            background-color: #444;
            color: #f5f5f5;
            font-size: 16px;
        }
        tr:nth-child(even) {
            background-color: #555;
        }
        tr:nth-child(odd) {
            background-color: #666;
        }
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            border: 2px solid #ff4c4c;
            background-color: transparent;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        input[type="checkbox"]:checked {
            background-color: #ff4c4c;
        }
        input[type="checkbox"]:hover {
            background-color: #f72b2b;
        }
        @media (max-width: 600px) {
        .flag-container {
            width: 100%;
            height: auto;
            aspect-ratio: 3 / 2;
        }
        .overlay-piece {
            height: 100%;
        }
        }
        tr.selected {
            background-color: #4CAF50;
            color: white;
        }
        tr.selected td {
            background-color: #4CAF50;
        }
        .rule-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #ff4c4c;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
            z-index: 1000;
        }
        .rule-button:hover {
            background-color: #f72b2b;
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }
        .rule-button:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(255, 76, 76, 0.7);
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            padding-top: 60px;
        }
        .modal-content {
            background-color: #333;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            color: #f5f5f5;
        }
        .close-btn {
            color: #ff4c4c;
            font-size: 30px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 25px;
            cursor: pointer;
        }
        .close-btn:hover {
            color: #f72b2b;
        }
        #checkboxTable tr:first-child {
            filter: none;
            pointer-events: auto;
            opacity: 1;
        }
        #challengeModal .modal-content {
            background-color: #2a2a2a;
            color: #f5f5f5;
            border-radius: 12px;
            padding: 25px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(255, 76, 76, 0.4);
        }
        #challengeModal h2 {
            color: #ff4c4c;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 1px 1px 5px rgba(255, 76, 76, 0.4);
        }
        #challengeList li {
            background-color: #444;
            border: 1px solid #555;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            transition: transform 0.2s, background-color 0.3s;
        }
        #challengeList li:hover {
            background-color: #555;
            transform: scale(1.02);
        }
        #challengeModal input[type="text"] {
            background-color: #333;
            border: 1px solid #555;
            color: #fff;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
            transition: border-color 0.3s;
        }
        #challengeModal input[type="text"]:focus {
            border-color: #ff4c4c;
            outline: none;
        }
        #addChallenge {
            background-color: #00b0ff;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 176, 255, 0.4);
            transition: all 0.3s ease;
        }

        #addChallenge:hover {
            background-color: #0091cc;
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0, 176, 255, 0.6);
        }

        #addChallenge:active {
            transform: scale(0.97);
        }

    </style>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBWG6exyWmdMZoOr-WJ-SOrYoBqxsP9F_w",
            authDomain: "tieulinhhota-30-4.firebaseapp.com",
            projectId: "tieulinhhota-30-4",
            storageBucket: "tieulinhhota-30-4.firebasestorage.app",
            messagingSenderId: "1080321938893",
            appId: "1:1080321938893:web:75f0d28af7a647d493e084",
            measurementId: "G-HKPZDZFZ8M"
        };
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>
</head>
<body>
    <h1>üéâ Ch√†o m·ª´ng ng√†y 30/4 ‚Äì Gi·∫£i ph√≥ng mi·ªÅn Nam Vi·ªát Nam</h1>
    <div class="flag-container" id="flagContainer">
        <!-- Dynamically generated overlay pieces -->
    </div>
    <table>
        <thead>
            <tr>
                <th>‚úî</th>
                <th>Giai ƒëo·∫°n</th>
                <th>M·ªëc L·ªãch S·ª≠</th>
                <th>C·ªët truy·ªán</th>
            </tr>
        </thead>
        <tbody id="checkboxTable">
            <!-- Dynamically generated table rows -->
        </tbody>
    </table>
    <button id="challengeButton" class="rule-button" style="bottom: 80px;">üìú Request th·ª≠ th√°ch</button>
    <div id="challengeModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeChallengeModal">√ó</span>
            <h2>Danh s√°ch th·ª≠ th√°ch</h2>
            <div>
                <input type="password" id="passwordInput" placeholder="Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ x√≥a th·ª≠ th√°ch">
                <button id="checkPasswordBtn">X√°c nh·∫≠n m·∫≠t kh·∫©u</button>
            </div>
            <div style="margin-top: 20px; display: flex; flex-direction: column; align-items: center; gap: 10px;">
                <input id="nameInput" type="text" placeholder="T√™n c·ªßa b·∫°n" style="padding: 8px; width: 250px; border: 2px solid #ddd; border-radius: 5px; background-color: #f5f5f5; color: #333; font-size: 14px; font-family: Arial, sans-serif; outline: none; transition: border-color 0.3s;">
                <textarea id="challengeInput" placeholder="N·ªôi dung th·ª≠ th√°ch" style="padding: 8px; width: 250px; min-height: 100px; border: 2px solid #ddd; border-radius: 5px; background-color: #f5f5f5; color: #333; font-size: 14px; font-family: Arial, sans-serif; outline: none; resize: vertical; transition: border-color 0.3s;"></textarea>
                <button id="addChallenge" style="padding: 8px 15px; width: 100px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-family: Arial, sans-serif; transition: background-color 0.3s;">‚ûï</button>
            </div>
            <ul id="challengeList" style="list-style: none; padding-left: 0;"></ul>
        </div>
    </div>
    <button id="ruleButton" class="rule-button">üéÆ Quy T·∫Øc</button>
    <div id="ruleModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeModal">√ó</span>
            <h2>Quy T·∫Øc Tr√≤ Ch∆°i</h2>
            <p>1. M·ªói nhi·ªám v·ª• ho√†n th√†nh s·∫Ω m·ªü m·ªôt ph·∫ßn c·ªßa l√° c·ªù Vi·ªát Nam. Ho√†n th√†nh ƒë·ªß 20 nhi·ªám v·ª• s·∫Ω h√© l·ªô to√†n b·ªô b·ª©c tranh.</p>
            <p>2. M·ªói khi thi ƒë·∫•u 1 v√°n ƒë·∫•u h√£y check xem c√≥ tho·∫£ m√£n nhi·ªám v·ª• n√†o ƒë√≥ th√¨ h√£y ‚úî.</p>
            <p>3. M·ªôt v√°n ƒë·∫•u c√≥ th·ªÉ ho√†n th√†nh nhi·ªÅu nhi·ªám v·ª• 1 l√∫c, v√≠ d·ª• win 1 v√°n c√≥ combat c√≥ 200 mon 7 th√¨ t·∫•t c·∫£ nhi·ªám v·ª• mon 7 ƒë·ªÅu xong.</p>
            <p>4. M·ªói l·∫ßn nh·∫≠n donate 50.000 VND s·∫Ω gi·∫£m 50% y√™u c·∫ßu c·ªßa nhi·ªám v·ª• (Ch·ªâ ƒë·ªãnh 1 nhi·ªám v·ª•) s·ªë l∆∞·ª£ng c·∫ßn th·ª±c hi·ªán gi·∫£m m·ªôt n·ª≠a, ho·∫∑c n·∫øu nhi·ªám v·ª• c√≥ hai ƒëi·ªÅu ki·ªán th√¨ ƒë∆∞·ª£c mi·ªÖn m·ªôt trong hai.</p>
            <p>5. Nh·∫≠n ƒë∆∞·ª£c donate 100.000 VND cho ph√©p b·∫°n b·ªè qua m·ªôt nhi·ªám v·ª• ƒëang l√†m (T·ª©c ho√†n th√†nh lu√¥n).</p>
            <p>6. Nh·∫≠n ƒë∆∞·ª£c donate 150.000 VND cho ph√©p viewer ƒë·ªïi n·ªôi dung nhi·ªám v·ª• ƒëang l√†m (Y√™u c·∫ßu confirm tr∆∞·ªõc t·ª´ streamer tr√°nh b·ªã b√≥p z√°i).</p>
            <p>7. M·ªói m·ªëc nhi·ªám v·ª• t∆∞∆°ng ·ª©ng v·ªõi 50.000 VND. Ho√†n th√†nh ƒë·ªß 20 m·ªëc s·∫Ω nh·∫≠n th√™m ph·∫ßn th∆∞·ªüng 500.000 VND, t·ªïng c·ªông l√† 1.500.000 VND.</p>
            <p>8. Th·ªùi gian tham gia: t·ª´ 00:00 ng√†y 30/04 ƒë·∫øn 23:59 ng√†y 01/05.</p>
        </div>
    </div>
    <script>
        const challengeButton = document.getElementById('challengeButton');
        const challengeModal = document.getElementById('challengeModal');
        const closeChallengeModal = document.getElementById('closeChallengeModal');
        const challengeList = document.getElementById('challengeList');
        const addChallengeBtn = document.getElementById('addChallenge');
        const nameInput = document.getElementById('nameInput');
        const challengeInput = document.getElementById('challengeInput');
        const passwordInput = document.getElementById('passwordInput');
        const checkPasswordBtn = document.getElementById('checkPasswordBtn');

        let hasSubscribedToChallengeUpdates = false;
        let isPasswordCorrect = false;

        challengeButton.addEventListener('click', () => {
            challengeModal.style.display = 'block';
            if (!hasSubscribedToChallengeUpdates) {
                subscribeToChallengeChanges();
                hasSubscribedToChallengeUpdates = true;
            }
        });

        closeChallengeModal.addEventListener('click', () => {
            challengeModal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === challengeModal) {
                challengeModal.style.display = 'none';
            }
        });

        checkPasswordBtn.addEventListener('click', () => {
            const enteredPassword = passwordInput.value.trim();
            if (enteredPassword === 'tieulinhhota') {
                isPasswordCorrect = true;
                alert('M·∫≠t kh·∫©u ch√≠nh x√°c! B·∫°n c√≥ th·ªÉ x√≥a th·ª≠ th√°ch v√† ch·ªânh s·ª≠a checkbox.');
                // Enable all checkboxes
                const checkboxes = document.querySelectorAll('#checkboxTable input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.disabled = false;
                });
                subscribeToChallengeChanges();
            } else {
                isPasswordCorrect = false;
                alert('M·∫≠t kh·∫©u kh√¥ng ch√≠nh x√°c.');
            }
        });

        function subscribeToChallengeChanges() {
            challengeList.innerHTML = '<li>ƒêang t·∫£i...</li>';
            db.collection("challenges").onSnapshot(snapshot => {
                challengeList.innerHTML = '';
                if (snapshot.empty) {
                    challengeList.innerHTML = '<li>Ch∆∞a c√≥ th·ª≠ th√°ch n√†o.</li>';
                    return;
                }

                snapshot.forEach(doc => {
                    const { name, content, time } = doc.data();
                    const li = document.createElement('li');
                    li.textContent = `[${time}] ‚öîÔ∏è ${name}: ${content}`;
                    li.style.display = 'flex';
                    li.style.alignItems = 'center';
                    li.style.justifyContent = 'space-between';

                    if (isPasswordCorrect) {
                        const deleteBtn = document.createElement('button');
                        deleteBtn.textContent = '‚ùå';
                        deleteBtn.style.cursor = 'pointer';
                        deleteBtn.style.background = 'none';
                        deleteBtn.style.border = 'none';
                        deleteBtn.style.color = 'red';
                        deleteBtn.style.fontSize = '18px';
                        deleteBtn.addEventListener('click', async () => {
                            try {
                                await db.collection("challenges").doc(doc.id).delete();
                                alert('ƒê√£ x√≥a th·ª≠ th√°ch!');
                            } catch (err) {
                                alert(`L·ªói khi x√≥a th·ª≠ th√°ch: ${err.message}`);
                            }
                        });
                        li.appendChild(deleteBtn);
                    }

                    challengeList.appendChild(li);
                });
            }, error => {
                challengeList.innerHTML = `<li style="color:red;">L·ªói realtime: ${error.message}</li>`;
            });
        }

        addChallengeBtn.addEventListener('click', async () => {
            const name = nameInput.value.trim();
            const content = challengeInput.value.trim();

            if (!name || !content) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß t√™n v√† th·ª≠ th√°ch.');
                return;
            }

            const currentDate = new Date();
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const day = String(currentDate.getDate()).padStart(2, '0');
            const hours = String(currentDate.getHours()).padStart(2, '0');
            const minutes = String(currentDate.getMinutes()).padStart(2, '0');
            const formattedDate = `${year}-${month}-${day} ${hours}:${minutes}`;

            try {
                await db.collection("challenges").add({
                    name: name,
                    content: content,
                    time: formattedDate
                });

                nameInput.value = '';
                challengeInput.value = '';
            } catch (err) {
                alert(`L·ªói khi th√™m th·ª≠ th√°ch: ${err.message}`);
            }
        });

        const data = [
            {
                id: 0,
                content: "1858 - Ph√°p x√¢m l∆∞·ª£c ƒê√† N·∫µng",
                note: "M·ªü ƒë·∫ßu cu·ªôc x√¢m l∆∞·ª£c c·ªßa th·ª±c d√¢n Ph√°p v√†o Vi·ªát Nam.",
                status: "Ho√†n th√†nh tr·∫≠n ƒë·∫•u tr√™n b·∫•t k·ª≥ b·∫£n ƒë·ªì n√†o. (Note: Ho√†nh th√†nh tr·∫≠n ƒë·∫•u t·ª©c ch·ªâ y√™u c·∫ßu ho√†n th√†nh kh√¥ng y√™u c·∫ßu gi√†nh chi·∫øn th·∫Øng)"
            },
            {
                id: 1,
                content: "1862 - Hi·ªáp ∆∞·ªõc Nh√¢m Tu·∫•t",
                note: "Ph√°p chi·∫øm ba t·ªânh mi·ªÅn ƒê√¥ng Nam B·ªô.",
                status: "Ho√†n th√†nh tr·∫≠n ƒë·∫•u c√≥ combat v√† b·∫°n ph·∫£i l√† ng∆∞·ªùi b·ªã t·∫•n c√¥ng."
            },
            {
                id: 2,
                content: "1867 - Ph√°p chi·∫øm n·ªët mi·ªÅn T√¢y Nam B·ªô",
                note: "Ph√°p ho√†n t·∫•t vi·ªác chi·∫øm Nam K·ª≥.",
                status: "Break th√†nh c√¥ng ·ªü 124 (donate 50k ƒë·ªÉ ƒë∆∞a v·ªÅ 127)"
            },
            {
                id: 3,
                content: "1884 - Hi·ªáp ∆∞·ªõc Paten√¥t",
                note: "Vi·ªát Nam ch√≠nh th·ª©c tr·ªü th√†nh thu·ªôc ƒë·ªãa c·ªßa Ph√°p.",
                status: "Ho√†n th√†nh tr·∫≠n ƒë·∫•u c√≥ combat, s·ªü h·ªØu √≠t nh·∫•t 100 qu√°i c·∫•p 6 v√† gi√†nh chi·∫øn th·∫Øng"
            },
            {
                id: 4,
                content: "1905 - Phong tr√†o ƒê√¥ng Du",
                note: "Phan B·ªôi Ch√¢u k√™u g·ªçi du h·ªçc Nh·∫≠t ƒë·ªÉ c·ª©u n∆∞·ªõc.",
                status: "Ho√†n th√†nh tr·∫≠n ƒë·∫•u c√≥ combat v√† b·∫°n s·ªü h·ªØu hai k·ªπ nƒÉng: Logistics & Pathfinding."
            },
            {
                id: 5,
                content: "1911 - H·ªì Ch√≠ Minh ra ƒëi t√¨m ƒë∆∞·ªùng c·ª©u n∆∞·ªõc",
                note: "Kh·ªüi ƒë·∫ßu h√†nh tr√¨nh c√°ch m·∫°ng c·ªßa B√°c.",
                status: "Ho√†n th√†nh tr·∫≠n ƒë·∫•u c√≥ combat v√† b·∫°n s·ªü h·ªØu hai k·ªπ nƒÉng: Offense & Armorer."
            },
            {
                id: 6,
                content: "1919 - G·ª≠i y√™u s√°ch ƒë·∫øn Versailles",
                note: "Nguy·ªÖn √Åi Qu·ªëc y√™u c·∫ßu quy·ªÅn t·ª± quy·∫øt cho d√¢n t·ªôc.",
                status: "Gi√†nh chi·∫øn th·∫Øng tr·∫≠n ƒë·∫•u c√≥ combat, s·ªü h·ªØu √≠t nh·∫•t 50 qu√°i c·∫•p 7"
            },
            {
                id: 7,
                content: "1930 - Th√†nh l·∫≠p ƒê·∫£ng C·ªông s·∫£n Vi·ªát Nam",
                note: "D∆∞·ªõi s·ª± l√£nh ƒë·∫°o c·ªßa H·ªì Ch√≠ Minh.",
                status: "Gi√†nh chi·∫øn th·∫Øng m·ªôt tr·∫≠n ƒë·∫•u c√≥ combat m√† kh√¥ng s·ª≠ d·ª•ng item Elixir of Life"
            },
            {
                id: 8,
                content: "1930-1931 - Kh·ªüi nghƒ©a Y√™n B√°i",
                note: "Phong tr√†o ch·ªëng Ph√°p c·ªßa Vi·ªát Nam Qu·ªëc D√¢n ƒê·∫£ng.",
                status: "Ho√†n th√†nh tr·∫≠n ƒë·∫•u c√≥ combat v√† b·∫°n c√≥ hai k·ªπ nƒÉng: Tactics v√† Ballistics."
            },
            {
                id: 9,
                content: "1941 - H·ªì Ch√≠ Minh v·ªÅ n∆∞·ªõc",
                note: "Chu·∫©n b·ªã l·ª±c l∆∞·ª£ng cho c√°ch m·∫°ng.",
                status: "Ho√†n th√†nh tr·∫≠n ƒë·∫•u c√≥ combat v√† b·∫°n s·ªü h·ªØu √≠t nh·∫•t 200 qu√°i c·∫•p 6."
            },
            {
                id: 10,
                content: "1945 - C√°ch m·∫°ng Th√°ng T√°m",
                note: "Gi√†nh ch√≠nh quy·ªÅn tr√™n to√†n qu·ªëc.",
                status: "Nh·∫≠n 1 l·∫ßn 200k donate ho·∫∑c c√≥ chu·ªói 3 win ho·∫∑c 3 lose"
            },
            {
                id: 11,
                content: "1945 - Tuy√™n ng√¥n ƒë·ªôc l·∫≠p",
                note: "Khai sinh n∆∞·ªõc Vi·ªát Nam D√¢n ch·ªß C·ªông h√≤a.",
                status: "Ho√†n th√†nh tr·∫≠n ƒë·∫•u c√≥ combat v√† b·∫°n c√≥ ƒë·ªß 4 nguy√™n t·ªë trong skill tree: ƒê·∫•t, N∆∞·ªõc, L·ª≠a, Gi√≥."
            },
            {
                id: 12,
                content: "1946 - B·∫Øt ƒë·∫ßu kh√°ng chi·∫øn ch·ªëng Ph√°p",
                note: "Cu·ªôc kh√°ng chi·∫øn to√†n qu·ªëc b√πng n·ªï.",
                status: "Ho√†n th√†nh tr·∫≠n ƒë·∫•u, c√≥ combat v√† gi√†nh chi·∫øn th·∫Øng (trong combat ch·ªâ ƒë∆∞·ª£c mang qu√°i c·∫•p 7)."
            },
            {
                id: 13,
                content: "1954 - Chi·∫øn th·∫Øng ƒêi·ªán Bi√™n Ph·ªß - Hi·ªáp ƒë·ªãnh Gen√®ve",
                note: "Ch·∫•m d·ª©t chi·∫øn tranh ƒê√¥ng D∆∞∆°ng.",
                status: "Gi√†nh chi·∫øn th·∫Øng m·ªôt tr·∫≠n ƒë·∫•u c√≥ combat m√† kh√¥ng s·ª≠ d·ª•ng qu√°i c·∫•p 7 (n·∫øu c√≥ donate gi·∫£m m·ªôt n·ª≠a th√¨ ƒë∆∞·ª£c mi·ªÖn ƒëi·ªÅu ki·ªán v·ªÅ qu√°i)."
            },
            {
                id: 14,
                content: "1955 - Ng√¥ ƒê√¨nh Di·ªám n·∫Øm quy·ªÅn",
                note: "B·∫Øt ƒë·∫ßu ch√≠nh th·ªÉ VNCH ·ªü mi·ªÅn Nam.",
                status: "Ho√†n th√†nh tr·∫≠n ƒë·∫•u c√≥ combat, kh√¥ng s·ª≠ d·ª•ng Scouting v√† Logistics (kh√¥ng y√™u c·∫ßu th·∫Øng)."
            },
            {
                id: 15,
                content: "1964 - S·ª± ki·ªán V·ªãnh B·∫Øc B·ªô",
                note: "Kh·ªüi ƒë·∫ßu s·ª± can thi·ªáp qu√¢n s·ª± tr·ª±c ti·∫øp c·ªßa M·ªπ.",
                status: "Ho√†n th√†nh tr·∫≠n ƒë·∫•u c√≥ combat v√† gi√†nh chi·∫øn th·∫Øng ƒë·ªìng th·ªùi ƒë√†o ƒë∆∞·ª£c grail (kho b√°u)"
            },
            {
                id: 16,
                content: "1965 - M·ªπ ƒë·ªï qu√¢n v√†o Vi·ªát Nam",
                note: "Chi·∫øn tranh Vi·ªát Nam b∆∞·ªõc v√†o giai ƒëo·∫°n kh·ªëc li·ªát.",
                status: "Gi√†nh chi·∫øn th·∫Øng + c√≥ combat v√† b·∫°n s·ªü h·ªØu k·ªπ nƒÉng Archery v√† set bow of sharpshooter"
            },
            {
                id: 17,
                content: "1968 - T·ªïng ti·∫øn c√¥ng T·∫øt M·∫≠u Th√¢n",
                note: "ƒê√≤n t·∫•n c√¥ng b·∫•t ng·ªù l√†m ch·∫•n ƒë·ªông n∆∞·ªõc M·ªπ.",
                status: "Gi√†nh chi·∫øn th·∫Øng + c√≥ combat v√† b·∫°n s·ªü h·ªØu k·ªπ nƒÉng Diplomacy."
            },
            {
                id: 18,
                content: "1973 - Hi·ªáp ƒë·ªãnh Paris",
                note: "M·ªπ r√∫t qu√¢n kh·ªèi Vi·ªát Nam.",
                status: "Ho√†n th√†nh tr·∫≠n ƒë·∫•u c√≥ combat v√† gi√†nh chi·∫øn th·∫Øng trong th√°ng 2."
            },
            {
                id: 19,
                content: "1975 - Gi·∫£i ph√≥ng mi·ªÅn Nam",
                note: "Th·ªëng nh·∫•t ƒë·∫•t n∆∞·ªõc, ch·∫•m d·ª©t chi·∫øn tranh.",
                status: "Ho√†n th√†nh tr·∫≠n ƒë·∫•u c√≥ combat, s·ªü h·ªØu √≠t nh·∫•t 100 qu√°i c·∫•p 7."
            }
        ];

        const checkboxTable = document.getElementById('checkboxTable');
        const flagContainer = document.getElementById('flagContainer');

        // Generate overlay pieces
        for (let i = 0; i < data.length; i++) {
            const overlay = document.createElement('div');
            overlay.classList.add('overlay-piece');
            overlay.style.left = `${i * (100 / data.length)}%`;
            overlay.dataset.index = i;
            flagContainer.appendChild(overlay);
        }

        // Generate table rows with disabled checkboxes
        for (let i = 0; i < data.length; i++) {
            const row = data[i];
            const tr = document.createElement('tr');
            if (i > 0) {
                tr.classList.add('blurred');
            }

            const tdCheckbox = document.createElement('td');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.dataset.index = row.id;
            checkbox.disabled = true; // Disable checkbox by default
            tdCheckbox.appendChild(checkbox);

            const tdContent = document.createElement('td');
            tdContent.textContent = row.content;

            const tdNote = document.createElement('td');
            tdNote.textContent = row.note;

            const tdStatus = document.createElement('td');
            tdStatus.textContent = row.status;

            tr.appendChild(tdCheckbox);
            tr.appendChild(tdContent);
            tr.appendChild(tdNote);
            tr.appendChild(tdStatus);
            checkboxTable.appendChild(tr);
        }

        async function saveCheckboxState(index, checked) {
            try {
                const docRef = db.collection("checkbox_status").doc("global");
                const doc = await docRef.get();
                let checkedStatus = doc.exists ? doc.data().checkedStatus : {};
                
                if (checked) {
                    checkedStatus[index] = true;
                } else {
                    checkedStatus[index] = false;
                }
                
                await docRef.set({ checkedStatus }, { merge: true });
            } catch (err) {
                console.error(`L·ªói khi l∆∞u tr·∫°ng th√°i checkbox: ${err.message}`);
            }
        }

        async function loadCheckboxState() {
            try {
                const doc = await db.collection("checkbox_status").doc("global").get();
                const checkedStatus = doc.exists ? doc.data().checkedStatus : {};
                Object.keys(checkedStatus).forEach(index => {
                    console.log(checkedStatus, index);
                    const checkbox = checkboxTable.querySelector(`input[data-index="${index}"]`);
                    if (checkbox && checkedStatus[index] === true) { // Ch·ªâ check n·∫øu gi√° tr·ªã l√† true
                        checkbox.checked = true;
                        handleCheckboxChange(checkbox, true);
                    }
                });
            } catch (err) {
                console.error(`L·ªói khi t·∫£i tr·∫°ng th√°i checkbox: ${err.message}`);
            }
        }

        function handleCheckboxChange(checkbox, isInit = false) {
            const index = parseInt(checkbox.dataset.index);
            const overlay = flagContainer.querySelector(`.overlay-piece[data-index="${index}"]`);
            const row = checkbox.closest('tr');

            if (checkbox.checked) {
                overlay.classList.add('hidden');
                row.classList.add('selected');
                const nextRow = checkboxTable.querySelector(`tr:nth-child(${index + 2})`);
                if (nextRow) nextRow.classList.remove('blurred');
            } else {
                overlay.classList.remove('hidden');
                row.classList.remove('selected');
                const nextRow = checkboxTable.querySelector(`tr:nth-child(${index + 2})`);
                if (nextRow) nextRow.classList.add('blurred');
            }

            if (!isInit) {
                saveCheckboxState(index, checkbox.checked);
            }
        }

        checkboxTable.addEventListener('change', (e) => {
            if (e.target.type === 'checkbox') {
                handleCheckboxChange(e.target);
            }
        });

        const ruleButton = document.getElementById('ruleButton');
        const ruleModal = document.getElementById('ruleModal');
        const closeModal = document.getElementById('closeModal');

        ruleButton.addEventListener('click', () => {
            ruleModal.style.display = 'block';
        });

        closeModal.addEventListener('click', () => {
            ruleModal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === ruleModal) {
                ruleModal.style.display = 'none';
            }
        });

        // Load checkbox states when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            loadCheckboxState();
        });
    </script>
</body>
</html>
